// Copyright (c) 2023 RTE (http://www.rte-france.com)
// See AUTHORS.txt
// This document is subject to the terms of the Creative Commons Attribution 4.0 International license.
// If a copy of the license was not distributed with this
// file, You can obtain one at https://creativecommons.org/licenses/by/4.0/.
// SPDX-License-Identifier: CC-BY-4.0

= Migration Guide from release 3.15.0 to release 4.0.0

== Management of core menus and custom menus
The structure of the `ui-menu.json` file has changed. Fields `coreMenusConfiguration` and `menus` do not exist anymore.

Now `ui-menu.json` file contains 4 fields :

* `navigationBar` : contains the navigation bar mixing core menus and custom menus
* `topRightIconMenus` : contains only the two menu icons `agenda` and `usercard` on the top right of the screen
* `topRightMenus` : contains the core menus you want to see when you click the user, on the top right of the screen
* `locales` : contains the translations for the custom menus

NOTE: With the new structure of the file, it is now possible to mix core menus and custom menus in the navigation bar.

You can find more information and a full example in the documentation :
https://opfab.github.io/documentation/current/reference_doc/#menu_entries


== OpfabAPI 

Use of methods or attributes starting with templateGateway are now deprecated , the following table give you the new methods to use 

|===
|Deprecated method or attribute | New method 

|templateGateway.getEntityName(entityId)
|opfab.users.entities.getEntityName(entityId)

|templateGateway.getEntity(entityId)
|opfab.users.entities.getEntity(entityId)

|templateGateway.getAllEntities()
|opfab.users.entities.getAllEntities()

|templateGateway.redirectToBusinessMenu(menuId, menuItemId, urlExtension)
|opfab.navigate.redirectToBusinessMenu(menuId, menuItemId, urlExtension)

|templateGateway.isUserAllowedToRespond()
|opfab.currentCard.isUserAllowedToRespond()

|templateGateway.isUserMemberOfAnEntityRequiredToRespond()
|opfab.currentCard.isUserMemberOfAnEntityRequiredToRespond()

|templateGateway.getEntitiesAllowedToRespond()
|opfab.currentCard.getEntitiesAllowedToRespond()

|templateGateway.getEntityUsedForUserResponse()
|opfab.currentCard.getEntityUsedForUserResponse()

|templateGateway.getDisplayContext()
|opfab.currentCard.getDisplayContext()

|templateGateway.displayLoadingSpinner()
|opfab.currentCard.displayLoadingSpinner()

|templateGateway.hideLoadingSpinner()
|opfab.currentCard.hideLoadingSpinner()

|templateGateway.childCards
|opfab.currentCard.getChildCards()

|templateGateway.isLocked
|opfab.currentCard.isResponseLocked()

|templateGateway.lockAnswer = function () {//do some stuff}
|opfab.currentCard.listenToResponseLock( () => {//do some stuff} )

|templateGateway.unlockAnswer = function () {//do some stuff}
|opfab.currentCard.listenToResponseUnlock( ()  => {//do some stuff} )

|templateGateway.setLttdExpired = function () {//do some stuff}
|opfab.currentCard.listenToLttdExpired( ()  => {//do some stuff} )

|templateGateway.onStyleChange = function () {//do some stuff}
|opfab.currentCard.listenToStyleChange( ()  => {//do some stuff} )

|templateGateway.setScreenSize =  function () {//do some stuff}
|opfab.currentCard.listenToScreenSize( ()  => {//do some stuff} )

|templateGateway.onTemplateRenderingComplete =  function () {//do some stuff}
|opfab.currentCard.listenToTemplateRenderingComplete( ()  => {//do some stuff} )

|templateGateway.getUserResponse =  function () {//do some stuff}
|opfab.currentCard.registerFunctionToGetUserResponse( ()  => {//do some stuff} )

|templateGateway.applyChildCards =  function () {//do some stuff}
|opfab.currentCard.listenToChildCards( ()  => {//do some stuff} )

|===