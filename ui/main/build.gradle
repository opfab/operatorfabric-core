npmInstall {
    inputs.files(fileTree('node_modules'))
    inputs.file('package.json')
    inputs.file('package-lock.json')
    inputs.file('angular.json')
    inputs.file('tslint.json')

    outputs.dir('build')

}

task runBuild(type: NpmTask) {
    inputs.files(fileTree('src'))
    inputs.files(fileTree('node_modules'))
    inputs.file('package.json')
    inputs.file('package-lock.json')
    inputs.file('angular.json')
    inputs.file('tslint.json')

    outputs.dir('build')

    dependsOn npmInstall
    args = ['run', 'build', '--configuration=production', '--baseHref=/ui/', '--deployUrl=/ui/']
}

task runHeadlessTests(type: NpmTask) {
    inputs.files(fileTree('src'))
    inputs.files(fileTree('node_modules'))
    inputs.file('package.json')
    inputs.file('package-lock.json')
    inputs.file('angular.json')
    inputs.file('tslint.json')

    outputs.dir('reports')

    dependsOn npmInstall
    args = ['run', 'headless']
}

test.dependsOn(runHeadlessTests)

task securityReport {
    dependsOn 'npm_run_audit'
}

build.dependsOn(runBuild)

assemble.dependsOn(runBuild)
